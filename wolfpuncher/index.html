<!DOCTYPE html>
<html>
<head>
<style>
.container {
  position: relative;
  overflow: hidden;
  height: 408px;
  width: 720px;

}
#IslandLady {
  display: block;
  height: 408px;
  width: 720px;
}

#ChillWolf {
  position: absolute;
  transform: rotate(-28deg);
  /*
  div by 6
  width: 121px;
  height: 120px;
  */
  /* div by 4
  726px wide, 720 px tall
  width: 181.5px;
  height: 180px;
  */
  /* div by 2
  width: 363px;
  height: 360px;
  */
  width: 242px;
  height: 240px;
  bottom: -10px;
  left: 10px;
  /* display: none; */
}
#AngryWolf {
  position: absolute;
  transform: rotate(-28deg);
  width: 242px;
  height: 240px;
  bottom: -10px;
  left: 10px;
  display: none;
}
#Fister {
  /* 447px wide x 350 px tall */
  position: absolute;
  width: 149px;
  height: 116.666px;
  top: 66px;
  right: 55px;
  transform: rotate(-25deg);
}
#Title {
  position: absolute;
  left: 160px;
}
#score {
  position: absolute;
  bottom: 10px;
  right: 19px;
  font-size: 1.5em;
}
#health {
  position: absolute;
  top: 95%;
  width: 100%;
  background-color: green;
  text-align: center;
}
#splosion {
  /*
  display: none;
  142px wide 200px tall
  */
  width: 142px;
  height: 200px;
  /*
  width: 213px;
  height: 300px;
  */
  bottom: -5px;
  left: 70px;
  position: absolute;
  display: none;
}
</style>
</head>
<body>
  <div class="container">
    <img src="./images/wolfpuncher_title.png" id="Title">
    <img src="./images/island_lady.jpeg" id="IslandLady">
    <img src="./images/chill_party_wolf_clear.png" id="ChillWolf" class="droppable">
    <img src="./images/angry_wolf_clear.png" id="AngryWolf">
    <img src="./images/splosion.gif" id="splosion">
    <img src="./images/ice-fist-clear.png" id="Fister">
    <p id="score">SCORE: 0</p>
    <!--
    <progress id="health" value="100" max="100"></progress>
  -->
  <div id="myProgress">
    <div id="health">100%</div>
  </div>
  </div>
  <audio id="music">
    <source src="./audio/music.mp3" type="audio/mpeg">
  </audio>
  <audio id="hit">
    <source src="./audio/whine.mp3" type="audio/mpeg">
  </audio>
  <audio id="wolfsplosion">
    <source src="./audio/wolfsplosion.mp3" type="audio/mpeg">
  </audio>
  <script>
  // function for game to end
  // change increaseWolfHealth to watchoverHealth
  // nap
  function sleep (time) {
  return new Promise((resolve) => setTimeout(resolve, time));
}
  // wolf takes damage
  // var wolfHealth = document.getElementById("health");
  var wolfHealth = document.getElementById("health");
  var health = 100;
  function dropWolfHealth() {
  // wolfHealth.value -= 1;
  // wolfHealth.style.value = wolfHealth;
  health -= 5;
  wolfHealth.innerHTML = health + "%";
  // wolfHealth.width = health;
  document.getElementById("health").style.width = health + "%";
}

  // wolf regenerates
  var wolfsplosionSound = document.getElementById("wolfsplosion")
  var wolfSplosion = document.getElementById("splosion");
  function increaseWolfHealth() {
    setInterval(function() {
      // wolfHealth.value += 0.3;
      if (health < 100) {
        health += 0.25;
      }
      // console.log('wolf health value: ' + wolfHealth.value);
      // console.log(wolf.Health.value > )
    // console.log("healing");
    if (health > 75) {
      console.log("green");
      document.getElementById("health").style.backgroundColor = "green";
    } else if (health > 25) {
      document.getElementById("health").style.backgroundColor = "yellow";
      console.log("yellow");
    } else if (health > 0) {
      document.getElementById("health").style.backgroundColor = "red";
      console.log("red");
    } else {
      console.log("lavasplosion");
      wolfsplosionSound.play();
      splosion.style.display = ('inline-block');
    }
    wolfHealth.innerHTML = health + "%";
    // wolfHealth.width = health;
    document.getElementById("health").style.width = health + "%";
    }, 100);
  }
  /*
  function increaseWolfHealth () {
  while (wolfHealth.value > 100) {
    console.log('healing');
    wolfHealth.value += 0.5;
  }
}
*/
// increaseWolfHealth();
  // start song on fister mousedown or touchstart
  var fister = document.getElementById("Fister");
  var music = document.getElementById("music");
  fister.addEventListener("mousedown", playMusic);
  fister.addEventListener("touchstart", playMusic);
  function playMusic() {
    music.loop = true;
    music.play();
    //increaseWolfHealth();
    increaseWolfHealth();
  };
  // wolf ouch noise on #chillWolf mousedown or touchstart
  var PartyWolf = document.getElementById("ChillWolf");
  var ouch = document.getElementById("hit");
  // PartyWolf.addEventListener("mousedown", ouchNoise);
  // PartyWolf.addEventListener("touchstart", ouchNoise);
  function ouchNoise() {
    // music.loop = true;
    ouch.currentTime = 0;
    ouch.play();
  }


  // show angry wolf
  var AngryWolf = document.getElementById("AngryWolf");
  function brieflyShowAngryWolf() {
    PartyWolf.style.display = ('none');
    AngryWolf.style.display = ('inline-block');
    sleep(300).then(() => {
      PartyWolf.style.display = ('inline-block');
      AngryWolf.style.display = ('none');
    });
  }


// touch or click support for moving
var hits = 0;
// console.log(i + j);
let currentDroppable = null;

fister.onmousedown = function(event) {

  let shiftX = event.clientX - fister.getBoundingClientRect().left;
  let shiftY = event.clientY - fister.getBoundingClientRect().top;

  fister.style.position = 'absolute';
  fister.style.zIndex = 1000;
  document.body.append(fister);

  moveAt(event.pageX, event.pageY);

  function moveAt(pageX, pageY) {
    fister.style.left = pageX - shiftX + 'px';
    fister.style.top = pageY - shiftY + 'px';
  }

  function onMouseMove(event) {
    moveAt(event.pageX, event.pageY);

    fister.hidden = true;
    let elemBelow = document.elementFromPoint(event.clientX, event.clientY);
    fister.hidden = false;

    if (!elemBelow) return;

    let droppableBelow = elemBelow.closest('.droppable');
    if (currentDroppable != droppableBelow) {
      if (currentDroppable) { // null when we were not over a droppable before this event
        leaveDroppable(currentDroppable);
      }
      currentDroppable = droppableBelow;
      if (currentDroppable) { // null if we're not coming over a droppable now
        // (maybe just left the droppable)
        enterDroppable(currentDroppable);
      }
    }
  }

  document.addEventListener('mousemove', onMouseMove);

  fister.onmouseup = function() {
    document.removeEventListener('mousemove', onMouseMove);
    fister.onmouseup = null;
  };

};

fister.ontouchstart = function(event) {

  let touchshiftX = event.touches[0].clientX - fister.getBoundingClientRect().left;
  let touchshiftY = event.touches[0].clientY - fister.getBoundingClientRect().top;

  fister.style.position = 'absolute';
  fister.style.zIndex = 1000;
  document.body.append(fister);

  touchmoveAt(event.touches[0].pageX, event.touches[0].pageY);

  function touchmoveAt(pageX, pageY) {
    fister.style.left = pageX - touchshiftX + 'px';
    fister.style.top = pageY - touchshiftY + 'px';
  }

  function onTouchMove(event) {
    touchmoveAt(event.touches[0].pageX, event.touches[0].pageY);

    fister.hidden = true;
    let touchelemBelow = document.elementFromPoint(event.touches[0].clientX, event.touches[0].clientY);
    fister.hidden = false;

    if (!touchelemBelow) return;

    let droppableBelow = touchelemBelow.closest('.droppable');
    if (currentDroppable != droppableBelow) {
      if (currentDroppable) { // null when we were not over a droppable before this event
        leaveDroppable(currentDroppable);
      }
      currentDroppable = droppableBelow;
      if (currentDroppable) { // null if we're not coming over a droppable now
        // (maybe just left the droppable)
        enterDroppable(currentDroppable);
      }
    }
  }

  document.addEventListener('touchmove', onTouchMove);

  fister.ontouchend = function() {
    document.removeEventListener('touchmove', onTouchMove);
    fister.ontouchend = null;
  };

};

function enterDroppable(elem) {
  ouchNoise()
  hits = hits + 1;
  brieflyShowAngryWolf();
  ouchNoise();
  dropWolfHealth()
  // console.log("hits: " + hits);
  document.getElementById("score").innerHTML = "SCORE: " + hits;

  // elem.style.background = 'pink';
}

function leaveDroppable(elem) {
  // j = j + 1;
  // console.log("j: " + j);
  elem.style.background = '';
}

fister.ondragstart = function() {
  return false;
};









  </script>
</body>
</html>
